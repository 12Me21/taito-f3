<!doctype html>

<style>
	f3-bits, f3-struct dt {
		font-family: courier, monospace;
		word-spacing: -0.25ch;
		font-size: 1.25em;
		line-height: 22px;
	}
	f3-struct, f3-addr, f3-data {
		display: flex;
		flex-direction: column;
	}
	f3-struct {
		margin-bottom: 1em;
	}
	f3-bits {
		border: 2px inset;
		display: inline-block;
		padding: 0 0.5ch;
		white-space: pre-wrap;
		align-self: flex-start;
	}
	f3-bits >* {
		font-weight: normal;
	}
	f3-bits b:nth-child(2n) {
		color: red;
	}
	f3-struct {
		border-left: solid black;
		padding: 0.5em 0 0.5em 1em;
	}
	f3-struct dt {
		margin-right: 0.5em;
		justify-self: right;
	}
	f3-struct dt::after {
		content: ":";
		font-weight: normal;
	}
	f3-struct dl {
		display: grid;
		grid: auto-flow / max-content 1fr;
		margin-left: 1em;
		margin-top: 0.25em;
		margin-bottom: 0em;
	}
	f3-struct f3-addr dl {
		margin-bottom: 0.5em;
	}
	f3-struct dl>* {
		align-self: baseline;
	}
	f3-struct dd {
		margin: 0;
	}
	f3-struct h1 {
		//font-style: italic;
		margin: 0;
		font-size: 1.5em;
		margin-bottom: 0.5em;
		margin-left: -0.25em;
	}
	f3-struct f3-addr h1, f3-struct f3-data h1 {
		font-size: 1.2em;
		margin: 0;
	}
	f3-struct dl dl {
		margin-left: 0;
		margin-top: 0;
		margin-bottom: 0;
	}
	f3-struct dl dl dt {
		font-size: unset;
	}
	dl[compact] {
		display: flex;
		flex-wrap: wrap;
	}
	dl[compact] > dd:not(:last-child) {
		margin-right: 1em;
	}
	dl[compact] > dt {
		margin-right: 0em;
	}
	dl[compact] > dt::after {
		content: "=";
	}
	abbr {
		font-variant-caps: small-caps;
	}
</style>

<style>
	table.bits {
		table-layout: fixed;
		background: repeating-linear-gradient(to right, black 0px 1.1px, white 0 6.25%)
	}
	table.bits th {
		font-size: 8px;
		font-weight: normal;
		border-right: 1px solid;
	}
	table.bits th:nth-child(4n) {
		border-right: 3px solid;
	}
	table.bits tr>* {
		font-family: courier, monospace;
		width: 16px;
		max-width: 16px;
		text-align: center;
		padding: 0;
	}
</style>

<table class=bits><tr><th>15<th>14<th>13<th>12<th>11<th>10<th>9<th>8<th>7<th>6<th>5<th>4<th>3<th>2<th>1<th>0<tr><td colspan=2>BB<td>E<td>I<td>c<td>c<td>c<td>c<td>i<td>i<td>i<td>i<td colspan=4>pppp</table>

<p>to help you get your bearings, here is an overview of the layout of graphics ram: (todo: baby mode table)</p>

<p>There are four playfields consisting of a 32x32 or 64x32 grid of 16x16px tiles.</p>

<f3-struct>
	<h1>Playfield Tile</h1>
	<f3-addr>
		<h1>Address</h1>
		<div><f3-bits>&ctdot; 01 0nnn yyyy yxxx xx--</f3-bits> (normal)</div>
		<div><f3-bits>&ctdot; 01 nnny yyyy xxxx xx--</f3-bits> (extend mode)</div>
		<dl>
			<dt>n<dd>playfield index
				<dl>
					<dt>0,1,2,3<dd>regular playfield data
					<dt>4,5<dd>alternate data for playfields 2 and 3
				</dl>
			<dt>y<dd>y index (0-31)
			<dt>x<dd>x index (0-31 or 0-64)
		</dl>
	</f3-addr>
	<f3-data>
		<h1>Data</h1>
		<f3-bits>hvTT ppsc cccc cccc  tttt tttt tttt tttt</f3-bits>
		<dl>
			<dt>t<dd>tile index (lower bits)
			<dt>c<dd>palette (0-511)
			<dt>s<dd>blend select
			<dt>p<dd>texture bit planes (bits per pixel select)
				<dl compact>
					<dt>0<dd>4bpp
					<dt>1<dd>5bpp
					<dt>2<dd>?
					<dt>3<dd>6bpp
				</dl>
			<dt>T<dd>tile index (upper bits)
			<dt>v<dd>vertical flip
			<dt>h<dd>horizontal flip
		</dl>
	</f3-data>
</f3-struct>

<p>the pivot layer is a 64x64 grid of 8x8 tiles, which gets its textures from RAM instead of ROM. it can either be in "text mode" (where the texture is looked up based on the tile's id) or "pixel mode" (where each cell has a unique texture, whose address depends on its position in the grid, effectively giving you a 512x256 bitmap, though the pixels are in a weird order)</p>

<f3-struct>
	<h1>Text Tile</h1>
	<f3-addr>
		<h1>Address</h1>
		<f3-bits>&ctdot; 01 110y yyyy yxxx xxx-</f3-bits>
		<dl>
			<dt>y<dd>y index (0-63)
			<dt>x<dd>x index (0-63)
		</dl>
	</f3-addr>
	<f3-data>
		<h1>Data</h1>
		<f3-bits>hccc cccv tttt tttt</f3-bits>
		<dl>
			<dt>t<dd>tile index (0-255)
			<dt>v<dd>vertical flip
			<dt>c<dd>palette (0-63)
			<dt>h<dd>horizontal flip
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Text Glyph</h1>
	<f3-addr>
		<h1>Address</h1>
		<f3-bits>&ctdot; 01 111t tttt ttt- ----</f3-bits>
		<dl>
			<dt>t<dd>tile index (0-255)
		</dl>
	</f3-addr>
	<f3-data>
		<h1>Data</h1>
		<div><f3-bits>bbbb bbbb bbbb bbbb bbbb bbbb bbbb bbbb</f3-bits> × 8</div>
		<dl>
			<dt>b<dd>8×8 bitmap, 4 bits per pixel
		</dl>
	</f3-data>
</f3-struct>

<p>pixel mode is similar to text mode, but the data for each tile is fetched based on the tile's position rather than the tile index in the text data.</p>

<f3-struct>
	<h1>Pixel Data Cell</h1>
	<f3-addr>
		<h1>Location:</h1>
		<f3-bits>&ctdot; 1b xxxx xxyy yyy- ----</f3-bits>
		<dl>
			<dt>b<dd>bank
			<dt>x<dd>x index (0-63)
			<dt>y<dd>y index (0-31)
		</dl>
	</f3-addr>
	<f3-data>
		<h1>Data</h1>
		<div><f3-bits>bbbb bbbb bbbb bbbb bbbb bbbb bbbb bbbb</f3-bits> × 8</div>
		<dl>
			<dt>b<dd>8×8 bitmap, 4 bits per pixel
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>common layer properties</h1>
	<dl>
		<dt>display enable<dd><dl compact><dt>0<dd>off<dt>1<dd>on</dl>(todo: hm does disabling turn off the updating of y position based on scale?)
		<dt>priority<dd>0-15. higher = above other things. two layers with the same priority can cause a conflict.
		<dt>clip invert<dd><dl compact><dt>0<dd>normal<dt>1<dd>inverted</dl>
		<dt>clip plane enable ×4<dd>one per clip plane<dl compact><dt>0<dd>off<dt>1<dd>on</dl>
		<dt>clip plane mode ×4<dd>one per clip plane<dl compact><dt>0<dd>hide inside<dt>1<dd>hide outside</dl>
		<dt>blend mode<dd>which half-pixel(s) to contribute to. encoding varies by layer
		<dt>blend select<dd>which of the 2 possible blend values will be used for a given half-pixel
		<dt>mosaic enable<dd><dl compact><dt>0<dd>off<dt>1<dd>on</dl>
	</dl>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 0.2 "4400" - Vertical Scroll Offset, Misc.</h1>
	<f3-data>
		<f3-bits>RLrl ??Ts ssss ssss</f3-bits>
		<dl>
			<dt>s<dd><i>playfield 2</i>: vertical scroll offset (format?)
			<dt>T<dd><i>playfield 2</i>: data location<dl compact><dt>0<dd>normal<dt>1<dd>alternate (tilemap number+2)</dl>
			<dt>l<dd>clip plane 0 left: upper bit
			<dt>r<dd>clip plane 0 right: upper bit
			<dt>L<dd>clip plane 1 left: upper bit
			<dt>R<dd>clip plane 1 right: upper bit
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 0.3 "4600"</h1>
	<div>(same as 0.3, but for playfield 3 and clip planes 2 and 3)</div>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 1.0 "5000" - Clip Planes</h1>
	<f3-data>
		<f3-bits>rrrr rrrr llll llll</f3-bits>
		<dl>
			<dt>l<dd><i>clip plane 0</i> left: lower bits
			<dt>r<dd><i>clip plane 0</i> right: lower bits
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 1.1 "5200"</h1>
	<div>(same as 1.0, but for clip plane 1)</div>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 1.2 "5400"</h1>
	<div>(same as 1.0, but for clip plane 2)</div>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 1.3 "5600"</h1>
	<div>(same as 1.0, but for clip plane 3)</div>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 2.0 "6000" - Misc Blending, Pivot Mode</h1>
	<f3-data>
		<f3-bits>B?p? oNAm ddcc bbaa</f3-bits>
		<dl>
			<dt>a<dd><i>sprite group 0</i>: <i>blend mode</i><dl compact><dt>0<dd>neither<dt>1<dd>left<dt>2<dd>right<dt>3<dd>both</dl>
			<dt>b<dd><i>sprite group 1</i>: <i>blend mode</i>
			<dt>c<dd><i>sprite group 2</i>: <i>blend mode</i>
			<dt>d<dd><i>sprite group 3</i>: <i>blend mode</i>
			<dt>m<dd><i>hicolor layer</i>: <i>blend value select</i>
			<dt>A<dd><i>pivot</i>: <i>blend value select</i>
			<dt>N<dd><i>background color</i>: <i>blend value select</i>
			<dt>o<dd>tilemap infinite vertical stretch?
			<dt>p<dd><i>pivot</i>: mode<dl compact><dt>0<dd>text<dt>1<dd>pixel</dl>
			<dt>B<dd><i>pivot</i>: pixel data location<dl compact><dt>0<dd>$620000 (conflicts with lineram)<dt>1<dd>$630000</dl>
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 2.1 "6200" - Blend Alpha Values</h1>
	<f3-data>
		<f3-bits>LLLL llll RRRR rrrr</f3-bits>
		<dl>
			<dt>r<dd>right half-pixel, blend select = 0<br>alpha = clamp((15-value)/8, 0, 1)<dl compact><dt>$0-$7<dd>100%<dt>$B<dd>50%<dt>$F<dd>0%</dl>
			<dt>R<dd>right half-pixel, blend select = 1
			<dt>l<dd>left half-pixel, blend select = 0
			<dt>L<dd>left half-pixel, blend select = 1
		</dl>
	</f3-data>
</f3-struct>
	
<f3-struct>
	<h1>Lineram Section 2.2 "6400" - Mosaic and <abbr>Fda</abbr> Settings</h1>
	<f3-data>
		<f3-bits>ffb? S?hs mmmm DCBA</f3-bits>
		<dl>
			<dt>A<dd><i>playfield 0</i>: <i>mosaic enable</i>
			<dt>B<dd><i>playfield 1</i>: <i>mosaic enable</i>
			<dt>C<dd><i>playfield 2</i>: <i>mosaic enable</i>
			<dt>D<dd><i>playfield 3</i>: <i>mosaic enable</i>
			<dt>m<dd>mosaic strength: samples every [16&minus;m] pixels
			<dt>s<dd><i>sprites</i>: <i>mosaic enable</i>
			<dt>h<dd><i>hicolor layer</i>: <i>mosaic enable</i>
			<dt>S<dd>?? shadow mode?
			<dt>b<dd><i><abbr>fda</abbr></i>: horizontal blur<dl compact><dt>0<dd>blurred<dt>1<dd>normal</dl>
			<dt>f<dd><i><abbr>fda</abbr></i>: mode<dl><dt>0<dd>15-bit <abbr>rgb</abbr> format (legacy mode)<dt>1<dd>normal mode<dt>2<dd>no blending, display half-pixels separately (debug mode?)<dt>3<dd>invalid? first pixel repeats all the way across</dl>
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 2.3 "6600" - Background Color Index</h1>
	<f3-data>
		<f3-bits>...b bbbb bbbb bbbb</f3-bits>
		<dl>
			<dt>b<dd><i>background color</i>: <i>color index</i>
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 3.0 "7000" - Hicolor Layer Blending</h1>
	<f3-data>
		<f3-bits>BBEI cccc iiii pppp</f3-bits>
		(same as playfield 0, but for the hicolor layer)
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 3.1 "7200" - Pivot Layer Blending</h1>
	<f3-data>
		<f3-bits>B?EI cccc iiii pppp</f3-bits>
		<dl>
			<dt>p<dd><i>pivot</i>: <i>priority</i> (0-15)
			<dt>i<dd><i>pivot</i>: <i>clip plane modes</i>
			<dt>c<dd><i>pivot</i>: <i>clip plane enables</i>
			<dt>I<dd><i>pivot</i>: <i>clip invert</i>
			<dt>E<dd><i>pivot</i>: <i>enable</i>
			<dt>B<dd><i>pivot</i>: <i>blend mode</i><dl compact><dt>0<dd>both<dt>1<dd>left</dl>
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 3.2 "7400" - Sprite Blending</h1>
	<f3-data>
		<f3-bits>DCBA ??EI cccc iiii</f3-bits>
		<dl>
			<dt>i<dd><i>sprites</i>: <i>clip plane modes</i>
			<dt>c<dd><i>sprites</i>: <i>clip plane enables</i>
			<dt>I<dd><i>sprites</i>: <i>clip invert</i>
			<dt>E<dd><i>sprites</i>: <i>enable</i>
			<dt>A<dd><i>sprite group 0</i>: <i>blend select</i>
			<dt>B<dd><i>sprite group 1</i>: <i>blend select</i>
			<dt>C<dd><i>sprite group 2</i>: <i>blend select</i>
			<dt>D<dd><i>sprite group 3</i>: <i>blend select</i>
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 3.3 "7600" - Sprite Group Priorities</h1>
	<f3-data>
		<f3-bits>dddd cccc bbbb aaaa</f3-bits>
		<dl>
			<dt>a<dd><i>sprite group 0</i>: <i>priority</i>
			<dt>b<dd><i>sprite group 1</i>: <i>priority</i>
			<dt>c<dd><i>sprite group 2</i>: <i>priority</i>
			<dt>d<dd><i>sprite group 3</i>: <i>priority</i>
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 4.0 "8000" - Playfield 0 Scale</h1>
	<f3-data>
		<f3-bits>xxxx xxxx yyyy yyyy</f3-bits>
		<dl>
			<dt>y<dd><i>playfield 0</i>: vertical scale
				<dl compact><dt>$00<dd><dt>$80<dd><dt>$FF<dd></dl>
			<dt>x<dd><i>playfield 0</i>: horizontal scale
				<dl compact><dt>$00<dd><dt>$80<dd><dt>$FF<dd></dl>
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 4.1 "8200" - Playfield 1 Scale</h1>
	<f3-data>
		<f3-bits>xxxx xxxx YYYY YYYY</f3-bits>
		<dl>
			<dt>y<dd><i>playfield 3</i>*: vertical scale<br>*bug: playfields 1 and 3 have their vertical scales swapped
			<dt>x<dd><i>playfield 1</i>: horizontal scale
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 4.2 "8400" - Playfield 2 Scale</h1>
	<f3-data>
		<f3-bits>xxxx xxxx yyyy yyyy</f3-bits>
		<dl>
			<dt>y<dd><i>playfield 2</i>: vertical scale
			<dt>x<dd><i>playfield 2</i>: horizontal scale
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 4.3 "8600" - Playfield 3 Scale</h1>
	<f3-data>
		<f3-bits>xxxx xxxx YYYY YYYY</f3-bits>
		<dl>
			<dt>y<dd><i>playfield 1</i>*: vertical scale
			<dt>x<dd><i>playfield 3</i>: horizontal scale
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 5.0 "9000" - Playfield 0 Palette Add</h1>
	<f3-data>
		<f3-bits>.... ..cc cccc cccc</f3-bits>
		<dl>
			<dt>c<dd><i>playfield 0</i>: offset added to the palette of all tiles
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 5.1 "9200"</h1>
	<div>(same as 5.0, but for playfield 1)</div>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 5.2 "9400"</h1>
	<div>(same as 5.0, but for playfield 2)</div>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 5.3 "9600"</h1>
	<div>(same as 5.0, but for playfield 3)</div>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 6.0 "A000" - Playfield 0 Local Scroll X</h1>
	<f3-data>
		<f3-bits>xxxx xxxx xxxx xxxx</f3-bits>
		<dl>
			<dt>s<dd><i>playfield 0</i>: local scroll x (same format as global scroll)
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 7.0 "B000" - Playfield 0 Blending</h1>
	<f3-data>
		<f3-bits>BBEI cccc iiii pppp<br>.... 3210 3210 ....</f3-bits>
		<dl>
			<dt>p<dd><i>playfield 0</i>: <i>priority</i> (0-15)
			<dt>i<dd><i>playfield 0</i>: <i>clip plane modes</i>
			<dt>c<dd><i>playfield 0</i>: <i>clip plane enables</i>
			<dt>I<dd><i>playfield 0</i>: <i>clip invert</i>
			<dt>E<dd><i>playfield 0</i>: <i>enable</i>
			<dt>B<dd><i>playfield 0</i>: <i>blend mode</i><dl compact><dt>0<dd>both<dt>1<dd>left<dt>2<dd>right<dt>3<dd>neither</dl>
		</dl>
	</f3-data>
</f3-struct>

<f3-struct>
	<h1>Lineram Section 7.2 "B200"</h1>
	<div>(same as 7.0, but for playfield 1)</div>
</f3-struct>

<script>
	for (let e of document.querySelectorAll('f3-bits')) {
	//	e.innerHTML = e.innerHTML.replace(/([a-zA-Z])( ?\1)*/g, "<b>$&</b>")
	}
</script>
