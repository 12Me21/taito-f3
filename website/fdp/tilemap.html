<!doctype html>
<script src=f3-bits.js></script>
<link rel=stylesheet href=../style.css>
<link rel=stylesheet href=./style2.css>

<a href=home.html>Back</a>
<h1>Tilemaps</h1>

<p>There are four tilemap layers, numbered 0 to 3.&nbsp;
	Each is a 32×32 (or 64×32 if Extend Mode is enabled) grid of tiles, represented by an array of 32-bit values.
	
<p>Each tile references a 16×16px texture, defined in <abbr>rom</abbr>, with up to 63 colors (plus transparent) per tile.&nbsp;
	Tilemaps can be scaled on both axes, with a range of 50.2% to infinity vertically, and 100% to 25600% horizontally.
	
	<todo>describe how scrolling works (e.g. units and such) and how it is affected by scaling. give formulas for positions etc.</todo>
	
<figure class=f3-struct>
	<h1>Tilemap Tiles</h1> <!-- note this is plural since we are describing multiple tiles -->
	<h2>Address (normal)</h2>
	<f3-bits>&ctdot;,0,0,1,0,num:3,y:5,x:5,-:2</f3-bits>
	<h2>Address (extend mode)</h2>
	<f3-bits>&ctdot;,0,0,1,num:3,y:5,x:6,-:2</f3-bits>
	<dl class=bits>
		<dt>num<dd>tile data number (0-5)
			<dl>
				<dt>0-3<dd>Tilemap 0-3: normal data
				<dt>4<dd>Tilemap 2: alternate data
				<dt>5<dd>Tilemap 3: alternate data
			</dl>
		<dt>y<dd>tile y index (0-31)
		<dt>x<dd>tile x index (0-31 or 0-63)
	</dl>
	<h2>Data</h2>
	<f3-bits>h,v,tex2:2,bpp:2,as,palette:9,texture:16</f3-bits>
	<dl class=bits>
		<dt>texture<dd>texture id (lower bits)
		<dt>palette<dd>palette id (0-511)
		<dt>as<dd>Alpha Select<br>(note how this is stored per-tile rather than per-scanline)
		<dt>bpp<dd>texture bit planes (bits per pixel select)<todo>better wording for bpp</todo>
			<dl>
				<dt>0<dd>16-color (4bpp)
				<dt>1<dd>32-color (5bpp)
				<dt>2<dd>?
  				<dt>3<dd>64-color (6bpp)
			</dl>
		<dt>tex2<dd>texture id (upper bits)
		<dt>v<dd><dl compact><dt>1<dd>vertical flip</dl>
		<dt>h<dd><dl compact><dt>1<dd>horizontal flip</dl>
	</dl>
</figure>

<figure class=f3-struct>
	<h1>Scroll Registers 0-3</h1>
	<h2>Address</h2>
	<f3-bits>&ctdot;,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,num:2,-</f3-bits>
	<dl class=bits>
		<dt>num<dd>tilemap number <var>N</var> (0-3)
	</dl>
	<h2>Data</h2>
	<f3-bits>ipart:10,fpart:6</f3-bits>
	<dl class=bits>
		<dt>ipart<dd>Tilemap <var>N</var>: Scroll X (integer part; 0-1024)<br>
			in units of: <div class=mathbox><math><mrow><mi>texture pixels</mi></mrow></math></div><br>
		<dt>fpart<dd>Tilemap <var>N</var>: Scroll X (negative fractional part)<br>
			in units of: <div class=mathbox><math><mrow><mo>&minus;</mo><mfrac><mrow><mi>texture pixels</mi></mrow><mn>64</mn></mfrac></mrow></math></div><br>
	</dl>
</figure>

<figure class=f3-struct>
	<h1>Scroll Registers 4-7</h1>
	<h2>Address</h2>
	<f3-bits>&ctdot;,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,num:2,-</f3-bits>
	<dl class=bits>
		<dt>num<dd>tilemap number <var>N</var> (0-3)
	</dl>
	<h2>Data</h2>
	<f3-bits>ipart:9,fpart:7</f3-bits>
	<dl class=bits>
		<dt>ipart<dd>Tilemap <var>N</var>: Scroll Y (integer part; 0-511)<br>
			in units of: <div class=mathbox><math><mrow><mi>texture pixels</mi></mrow></math></div>
		<dt>fpart<dd>Tilemap <var>N</var>: Scroll Y (fractional part)<br>
			in units of: <div class=mathbox><math><mrow><mfrac><mi>texture pixels</mi><mn>128</mn></mfrac></div>
			<br><todo>is this negative like x scroll?</todo>
	</dl>
</figure>

<figure class=f3-struct>
	<h1>Scroll Register 15</h1>
	<h2>Address</h2>
	<f3-bits>&ctdot;,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,-</f3-bits>
	<h2>Data</h2>
	<f3-bits>#:8,ex,#:7</f3-bits>
	<dl class=bits>
		<dt>ex<dd>Tilemaps: Extend Mode
			<dl><dt>0<dd>32×32 tilemaps<dt>1<dd>64×32 tilemaps</dl>
	</dl>
</figure>

<figure class=f3-struct>
	<h1>Lineram Registers 0.<var>N</var> "4400" "4600"</h1>
	<div>Note: supported on tilemaps 2 and 3 only.<todo>typeset this better</todo></div>
	<h2>Data</h2>
	<f3-bits>#:6,alt,yscroll:9</f3-bits>
	<dl class=bits>
		<dt>yscroll<dd>Tilemap <var>N</var>: Scroll Adjust Y (integer)<br>
			in units of: <div class=mathbox><math><mrow><mi>texture pixels</mi></mrow></math></div><br>
		<dt>alt<dd>Tilemap <var>N</var>: Alternate Tile Data<dl><dt>0<dd>normal<dt>1<dd>use alternate tile data</dl>
	</dl>
</figure>

<figure class=f3-struct>
	<h1>Lineram Register 2.0 "6000"</h1>
	<h2>Data</h2>
	<f3-bits>#:4,y,#:11</f3-bits>
	<dl class=bits>
		<dt>y<dd>Tilemaps: Scroll Sync
			<dl><dt>1<dd>initialize y scroll accumulators from the y scroll registers</dl>(basically: you should set this on the first scanline, or the playfields' y positions will be unstable)
	</dl>
</figure>

<figure class=f3-struct>
	<h1>Lineram Register 2.2 "6400"</h1>
	<h2>Data</h2>
	<f3-bits>#:12,p<sub>3</sub>,p<sub>2</sub>,p<sub>1</sub>,p<sub>0</sub></f3-bits>
	<dl class=bits>
		<dt>p<sub>N</sub><dd>Tilemap <var>N</var>: Mosaic Enable
	</dl>
</figure>

<figure class=f3-struct>
	<h1>Lineram Registers 4.<var>N</var> "8000" "8200" "8400" "8600"</h1>
	<h2>Data</h2>
	<f3-bits>hzoom:8,vzoom:8</f3-bits>
	<dl class=bits>
		<dt>vzoom<dd>Tilemap <var>N</var>*: Vertical Zoom<br>
			*bug: tilemaps 1 and 3 have their vertical zooms swapped<br>
			in units of: <div class=mathbox><math><mrow><mn>128</mn><mo>&InvisibleTimes;</mo><mo>(</mo><mfrac><mi>texture pixels</mi><mi>screen pixels</mi></mfrac><mo>)</mo></mrow></math></div><br>
			scale factor = 1 / (vzoom/128)<br>
			<dl><dt>$00<dd>∞×<dt>$40<dd>2.0×<dt>$80<dd>1.0×<dt>$C0<dd>0.667×<dt>$FF<dd>0.502×</dl>
		<dt>hzoom<dd>Tilemap <var>N</var>: Horizontal Zoom<br>
			in units of:
			<div class=mathbox><math><mrow><mn>256</mn><mo>&InvisibleTimes;</mo><mo>(</mo><mn>1</mn><mo>&minus;</mo><mfrac><mi>texture pixels</mi><mi>screen pixels</mi></mfrac><mo>)</mo></mrow></math></div><br>
			i.e. scale factor = 1 / (1 - hzoom/256)
			<dl><dt>$00<dd>1.0×<dt>$40<dd>1.333×<dt>$80<dd>2.0×<dt>$C0<dd>4.0×<dt>$FF<dd>256.0×</dl>
	</dl>
</figure>

<figure class=f3-struct>
	<h1>Lineram Registers 5.<var>N</var> "9000" "9200" "9400" "9600"</h1>
	<h2>Data</h2>
	<f3-bits>#:10,palette:6</f3-bits>
	<dl class=bits>
		<dt>palette<dd>Tilemap <var>N</var>: Palette Adjust (added to the palette of all tiles)
	</dl>
</figure>

<figure class=f3-struct>
	<h1>Lineram Registers 6.<var>N</var> "A000" "A200" "A400" "A600"</h1>
	<h2>Data</h2>
	<f3-bits>xscroll:16</f3-bits>
	<dl class=bits>
		<dt>xscroll<dd>Tilemap <var>N</var>: Scroll Adjust X<br>(same format as global scroll X)
	</dl>
</figure>

<figure class=f3-struct>
	<h1>Lineram Registers 7.<var>N</var> "B000" "B200" "B400" "B600"</h1>
	<h2>Data</h2>
	<f3-bits>bm:2,E,I,c<sub>3</sub>,c<sub>2</sub>,c<sub>1</sub>,c<sub>0</sub>,i<sub>3</sub>,i<sub>2</sub>,i<sub>1</sub>,i<sub>0</sub>,prio:4</f3-bits>
	<dl class=bits>
		<dt>prio<dd>Tilemap <var>N</var>: Priority (0-15)
		<dt>i<sub>n</sub><dd>Tilemap <var>N</var>: Clip Plane <var>n</var> Mode
		<dt>c<sub>n</sub><dd>Tilemap <var>N</var>: Clip Plane <var>n</var> Enable
		<dt>I<dd>Tilemap <var>N</var>: Clip Invert
		<dt>E<dd>Tilemap <var>N</var>: Enable
		<dt>bm<dd>Tilemap <var>N</var>: Blend Mode<dl><dt>0<dd>A+B<dt>1<dd>A<dt>2<dd>B<dt>3<dd>none</dl>
	</dl>
</figure>

<h2>Scroll Register Settings</h2>
<h3>Global Scroll X</h3>
<h3>Global Scroll Y</h3>
<h3>Playfield Extend Mode (shared)</h3>

<h2>Lineram Settings</h2>
<h3>Scroll Adjust X</h3>
<h3>Scroll Adjust Y (tilemaps 2 and 3 only)</h3>
<h3>Alternate Tile Data (tilemaps 2 and 3 only)</h3>
<h3>Playfield Y Scroll Sync (shared)</h3>
<h3>Zoom X</h3>
<h3>Zoom Y</h3>
<h3>Palette Adjust</h3>

