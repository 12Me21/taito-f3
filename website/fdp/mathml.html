<!doctype html>
<script src=f3-bits.js></script>
<link rel=stylesheet href=../style.css>
<link rel=stylesheet href=./style2.css>

the source of a scanline, in texture pixels is given by:

ytpx(scanline) + y_scroll_adjust[scanline]

where ytpx(scanline) = {
y_global_scroll / 128, if scroll_sync[scanline] is set
ytpx(scanline-1) + y_zoom[scanline] / 128, otherwise 


the source of a scanline, in texture pixels is given by:

<math>
	<mrow><mi>ytpx</mi><mo>(</mo>scanline</mi><mo>)</mo><mo>+</mo><mi>y_scroll_adjust</mi><mo>[</mo><mi>scanline</mi><mo>]</mo></mrow>
</math>

where
<math>
	<mrow><mi>ytpx</mi><mo>(</mo><mi>scanline</mi><mo>)</mo><mo>=</mo></mrow>
	<mrow>
		<mo>{</mo>
		<mtable columnalign="left left" rowspacing=".2em" columnspacing="1em" displaystyle="false">
			<mtr>
				<mtd><mi>y_global_scroll</mi><mo>/</mo><mn>128</mn><mtext>,</mtext></mtd>
				<mtd><mtext>if </mtext><mi>scroll_sync</mi><mo>[</mo><mi>scanline</mi><mo>]</mo><mtext> is set</mtext></mtd>
			</mtr>
			<mtr>
				<mtd>ytpx(scanline-1) + y_zoom[scanline] / 128,</mtd>
				<mtd>otherwise</mtd>
			</mtr>
		</mtable>
	</mrow>
</math>

<p>Thus, to convert a screen y position (in screen pixels) <var>y</var> to a source y position within a tilemap (in texture pixels), we can use:
	<math display=block>
		<mrow>
			<mrow>
				<mi>Global Scroll Y</mi>
			</mrow>
			<mo>+</mo>
			<mrow>
				<mi>Scroll Adjust Y</mi>
				<mo>(</mo><mi>y</mi><mo>)</mo>
			</mrow>
			<mo>+</mo>
			<mrow>
				<msubsup>
					<mo>&int;</mo>
					<mrow style=width:1em;><msub><mi>y</mi><mi>sync</mi></msub></mrow>
					<mrow><mi>y</mi></mrow>
				</msubsup>
				<mrow>
					<mi>Zoom Y</mi>
					<mo>(</mo><mi>n</mi><mo>)</mo>
				</mrow>
				<mspace width=thickmathspace></mspace>
				<mrow><mi>d</mi><mi>n</mi></mrow>
			</mrow>
		</mrow>
	</math>
	<details><summary>[Show] why is this an integral instead of a summation?</summary>
		Yes, it could be a Riemann sum with Δn = 1 screen pixel:
		<math display=block>
			<mrow>
				<munderover>
					<mo>&sum;</mo>
					<mrow><mi>n</mi><mo>=</mo><msub><mi>y</mi><mi>sync</mi></msub></mrow>
					<mrow><mi>y</mi><mo>&minus;</mo><mn>1</mn></mrow>
				</munderover>
				<mrow><mi>zoom</mi><mo>[</mo><mi>n</mi><mo>]</mo></mrow>
				<mo>&sdot;</mo>
				<mi>1</mi><mspace width=thinmathspace /><mi mathvariant=normal>screen pixel</mi>
			</mrow>
		</math>
		
	</details>
	
	Where:<br><var>global</var> is the tilemap's Global Scroll Y<br><var>adjust</var>(n) is its Scroll Adjust Y at a given screen y position<br><var>zoom</var>(n) is its Zoom Y at a given screen y position<br><var>y<sub>sync</sub></var> is the most recent scanline on which Scroll Sync was set (usually scanline 0).<br>
	Note that this assumes <var>y</var> ≥ <var>y<sub>sync</sub></var>.
	<br><todo>find a way to notate in the zoom field description that this has a scale factor of 128, as with global scroll</todo>
