<!doctype html><meta charset=utf-8>

<title>Main CPU Memory Map</title>
<link rel=icon sizes=16x16 href=fav.gif>
<link rel=stylesheet href=style.css>

<a href=home.html>Back</a>

<h1>Main <abbr>Cpu</abbr> Memory Map</h1>

<style>
	tr > *, table {
		border: 1px solid;
		border-collapse: collapse;
	}
	
	.memory-map tr > * {
		width: 50px;
		min-width: 50px;
	}
	.memory-map tr:not(:first-child) {
		height: 20px;
	}
	table.memory-map {
		table-layout: fixed;
		text-align: center;
	}
	.memory-map td {
		background: white;
	}
</style>

<h2>Visual Summary</h2>

<figure>
<table class=memory-map>
	<tr>
		<th><th>.00000<th>.10000<th>.20000<th>.30000<th>.40000<th>.50000<th>.60000<th>.70000<th>.80000<th>.90000<th>.A0000<th>.B0000<th>.C0000<th>.D0000<th>.E0000<th>.F0000
	</tr>
	<tr>
		<th>0.....
		<td colspan=16 rowspan=4 data-mirrors style=--m:1>Program <abbr>Rom</abbr> (maximum size)
	</tr>
	<tr>
		<th>1.....
	</tr>
	<tr>
		<th>2.....
	</tr>
	<tr>
		<th>3.....
		<!--<td>kirameki bank switch-->
	</tr>
	<tr>
		<th>4.....
		<td colspan=4 data-mirrors style=--m:2>Work <abbr>Ram</abbr>
		<td colspan=2 data-mirrors style=--m:4>Color <abbr>Ram</abbr>
		<td colspan=2 class=space>
		<td colspan=2 data-registers>Address Reflect
		<td colspan=2 data-registers><a href=fio-memory.html><abbr>Fio</abbr> Registers</a>
		<td colspan=2 data-registers>Timer Register
		<td colspan=2>Work <abbr>Ram</abbr>
	</tr>
	<tr>
		<th>5.....
	</tr>
	<tr>
		<th>6.....
		<td colspan=4 data-mirrors style=--m:1>Graphics <abbr>Ram</abbr>
		<td colspan=2 class=space>
		<td class=mem-cutoff data-registers style=font-size:0.75em><abbr>Fdp</abbr> Regs
		<td colspan=1 class=space>
		<td colspan=4>Graphics <abbr>Ram</abbr>
		<td colspan=2 class=space>
		<td class=mem-cutoff style=font-size:0.75em><abbr>Fdp</abbr> Regs
	</tr>
	<tr>
		<th>7.....
	</tr>
	<tr>
		<th>8.....
	</tr>
	<tr>
		<th>9.....
	</tr>
	<tr>
		<th>A.....
	</tr>
	<tr>
		<th>B.....
	</tr>
	<tr>
		<th>C.....
		<td colspan=8>Dual-Port <abbr>Ram</abbr>
		<td colspan=8>Sound Reset<br>
	</tr>
	<tr>
		<th>D.....
	</tr>
	<tr>
		<th>E.....
	</tr>
	<tr>
		<th>F.....
	</tr>
</table>
</figure>

<h2>Address Map</h2>

<figure>
<table class=table>
	<tr><th>Name<th>Address Bits<th style=font-size:0.5em;line-height:1>Address<br>Space<th>Width<th>R/W<th>Start<th>Real Size
	<tr><th>Program <abbr>Rom</abbr><td>[<bit-field>00aa aaaa aaaa aaaa aaaa aaAA</bit-field>]*<td>data/prg*<td>32-bit<td>R*<td><d-n>$000000</d-n><td><d-n>$400000*</d-n>
	<tr><th>Work <abbr>Ram</abbr><td>[<bit-field>0100 00.a aaaa aaaa aaaa aaAA</bit-field>]<br>[<bit-field>0100 111a aaaa aaaa aaaa aaAA</bit-field>]<td>data/?<td>32-bit<td>R/W<td><d-n>$400000</d-n><td><d-n>$20000</d-n>
	<tr><th>Color <abbr>Ram</abbr><td>[<bit-field>0100 010. .aaa aaaa aaaa aaAA</bit-field>]<td>data/?<td>32-bit<td>R/W<td><d-n>$440000</d-n><td><d-n>$8000</d-n>
	<tr><th>Address Reflect?<td>[<bit-field>0100 110. .... .... aaaa aaaa</bit-field>]<td>data/?<td>8-bit?<td>R?<td><d-n>$480000</d-n><td><d-n>$100</d-n>
	<tr><th><abbr>Fio</abbr> Registers<td>[<bit-field>0100 101. .... .... ...a aaaa</bit-field>]<td>data/?<td>8-bit<td>R/W<td><d-n>$4A0000</d-n><td><d-n>$20</d-n>
	<tr><th>Timer Register<td>[<bit-field>0100 110. .... .... .... ...A</bit-field>]<td>data/?<td>16-bit?<td>R/W<td><d-n>$4C0000</d-n><td><d-n>$2</d-n>
	<tr><th>Graphics <abbr>Ram</abbr><td>[<bit-field>0110 .0aa aaaa aaaa aaaa aaaA</bit-field>]<td>data/prg?<td>16-bit<td>R/W<td><d-n>$600000</d-n><td><d-n>$40000</d-n>
	<tr><th><abbr>Fdp</abbr> Registers<td>[<bit-field>0110 .110 0000 0000 000a aaaA</bit-field>]<td>data/?<td>16-bit<td>R/W<td><d-n>$660000</d-n><td><d-n>$20</d-n>
	<tr><th>Dual-Port <abbr>Ram</abbr><td>[<bit-field>1100 0... .... .aaa aaaa aaaa</bit-field>]<td>data/?<td>8-bit<td>R/W<td><d-n>$C00000</d-n><td><d-n>$800</d-n>
	<tr><th>Sound Reset Clear<td>[<bit-field>1100 1... .... ...0 .... ....</bit-field>]<td>data/?<td>32-bit<td>W?<td><d-n>$C80000</d-n><td>N/A
	<tr><th>Sound Reset Assert<td>[<bit-field>1100 1... .... ...1 .... ....</bit-field>]<td>data/?<td>32-bit<td>W?<td><d-n>$C80100</d-n><td>N/A
</table>
</figure>
<p>
	*The size and mapping of program <abbr>rom</abbr> depends on the cartridge.
	(but i think all extant games are basically the same)
<p>
	address bits legend:<br>
<dl>
	<dt><code>0</code>/<code>1</code><dd>mapping bit (must match)
	<dt><code>.</code><dd> doesn't matter
	<dt><code>a</code><dd> "real" address bit
	<dt><code>A</code><dd> address bit that just selects a byte within the data bus
</dl>
<h2>Notes</h2>
<p>
	Accessing unmapped addresses will freeze the <abbr>cpu</abbr>, not trigger a bus error<s-t>.</s-t>
<p>
	The <abbr>fdp</abbr> registers occupy exactly <d-n>$20</d-n> bytes of memory, and are <em>not</em> mirrored, unlike everything else (e.g. reading from <d-n>$660020</d-n> will freeze)<s-t>.</s-t>
<p>
	Color <abbr>ram</abbr> is mapped as 32-bit, but the first (highest) byte of each long-word is not connected to <abbr>ram</abbr><s-t>.</s-t>
<p>
	Reading from "Address Reflect" returns the low byte of the address as data<s-t>.</s-t> I'm not sure what the point of this is, nor of what happens when you write to it<s-t>.</s-t>
</p>
todo: what does read/write actually MEAN? like, you <em>can</em> try to write to program rom, nothing will happen though. and some registers (e.g. FIO) have different behavior on write, while some act like RAM.
also, need to test what happens when reading from "address reflect" or reading from sound reset

<li>sound reset reads [18, FC, 00, FF] (repeat)

<script src=link.js></script>
