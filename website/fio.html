<!doctype html><meta charset=utf8>

<title>TC0640 FIO</title>
<link rel=icon sizes=16x16 href=fav.gif>
<link rel=stylesheet href=style.css>

<a href=home.html>Back</a>

<style>
	.memory-map tr > *, table.memory-map  {
		border: 1px solid;
		border-collapse: collapse;
	}
	table.memory-map  {
		table-layout: fixed;
		line-height: 1;
		background: white;
		text-align: center;
	}
	.memory-map th {
		font-family: courier;
		background: #FFE;
	}
	.memory-map tr > * {
		width: 64px;
		min-width: 64px;
		max-width: 64px;
	}
	.memory-map td {
	}
	.s5 {
		background: #d9ead3;
	}
	.s8 {
		background: #fff2cc;
	}
	.memory-map tr:not(:first-child) {
		height: 50px;
	}
	.in {
		background-color: hsl(120, 100%, 90%);
	}
	.out {
		background-color: hsl(0, 100%, 87%);
	}
	.memory-map .in, .memory-map .out {
		vertical-align: bottom;
	}
	.dial {
		background-color: hsl(200, 80%, 80%);
	}
	pin-label {
		display: block;
		border: 1px solid gold;
		background: gold;
		font-family: monospace;
	}
</style>

<h1><img width=79 height=79 src=fio.gif><div>TC0640 FIO<br>&ldquo;F3 Input/Output&rdquo;</div></h1>

<h2>Registers</h2>

<p>(labels are based on F3 usage because that's what we've tested)

<table class=memory-map>
	<tr></tr>
	<tr class=in><td>input bit<pin-label>FIO pin</pin-label></tr>
	<tr class=out><td>output bit<pin-label>FIO pin</pin-label></tr>
	<tr class=dial><td>dial counter</tr>
</table>
<p>
<table class=memory-map>
	<tr>
		<th>address<th>bit 0<th>bit 1<th>bit 2<th>bit 3<th>bit 4<th>bit 5<th>bit 6<th>bit 7
	</tr>
	<tr>
		<th>0x00
		<td class=in>1p button4<pin-label>pin 92</pin-label>
		<td class=in>2p button4<pin-label>pin 89</pin-label>
		<td class=in>1p button5*<pin-label>pin 88?</pin-label>
		<td class=in>test (jamma)<pin-label>pin 87</pin-label>
		<td class=in>cartridge pin B1?<pin-label>pin 86?</pin-label>
		<td class=in>cartridge pin B2?<pin-label>pin 85?</pin-label>
		<td class=in>cartridge pin B3?<pin-label>pin 84?</pin-label>
		<td class=in>cartridge pin B4?<pin-label>pin 83?</pin-label>
	</tr>
	<tr>
		<th>0x01
		<td class=in>eeprom DO<pin-label>pin 82</pin-label>
		<td class=in>test (board)<pin-label>pin 81</pin-label>
		<td class=in>cartridge pin B5?<pin-label>pin 80?</pin-label>
		<td class=in>nc?<pin-label>pin 79?</pin-label>
		<td class=in>coin 1<pin-label>pin 78</pin-label>
		<td class=in>coin 2<pin-label>pin 77</pin-label>
		<td class=in>coin 3<pin-label>pin 76</pin-label>
		<td class=in>coin 4<pin-label>pin 74</pin-label>
	</tr>
	<tr>
		<th>0x02
		<td class=in>tilt<pin-label>pin 11</pin-label>
		<td class=in>service (jamma)<pin-label>pin 12</pin-label>
		<td class=in>service (3p)<pin-label>pin 13</pin-label>
		<td class=in>service (4p)<pin-label>pin 14</pin-label>
		<td class=in>1p start<pin-label>pin 16</pin-label>
		<td class=in>2p start<pin-label>pin 17</pin-label>
		<td class=in>3p start<pin-label>pin 18</pin-label>
		<td class=in>4p start<pin-label>pin 19</pin-label>
	</tr>
	<tr>
		<th>0x03
		<td class=in>1p button1<pin-label>pin 29</pin-label>
		<td class=in>1p button2<pin-label>pin 32</pin-label>
		<td class=in>1p button3<pin-label>pin 33</pin-label>
		<td class=in>nc<pin-label>pin 34?</pin-label>
		<td class=in>2p button1<pin-label>pin 36</pin-label>
		<td class=in>2p button2<pin-label>pin 37</pin-label>
		<td class=in>2p button3<pin-label>pin 38</pin-label>
		<td class=in>nc<pin-label>pin 39?</pin-label>
	</tr>
	<tr>
		<th>0x04
		<td class=out>coin 1 lockout<pin-label>pin 6</pin-label>
		<td class=out>coin 2 lockout<pin-label>pin 7</pin-label>
		<td class=out>coin 1 counter<pin-label>pin 8</pin-label>
		<td class=out>coin 2 counter<pin-label>pin 9</pin-label>
		<td colspan=4>?
	</tr>
	<tr>
		<th>0x05
		<td colspan=8>?
	</tr>
	<tr>
		<th>0x06
		<td colspan=8>?
	</tr>
	<tr>
		<th>0x07
		<td class=in>1p stick up<pin-label>pin 20</pin-label>
		<td class=in>1p stick down<pin-label>pin 21</pin-label>
		<td class=in>1p stick left<pin-label>pin 22</pin-label>
		<td class=in>1p stick right<pin-label>pin 23</pin-label>
		<td class=in>2p stick up<pin-label>pin 24</pin-label>
		<td class=in>2p stick down<pin-label>pin 25</pin-label>
		<td class=in>2p stick left<pin-label>pin 26</pin-label>
		<td class=in>2p stick right<pin-label>pin 27</pin-label>
	</tr>
	<tr>
		<th>0x08
		<td colspan=8 rowspan=2 class=dial>1p up/down dial counter
	</tr>
	<tr>
		<th>0x09
	</tr>
	<tr>
		<th>0x0A
		<td colspan=8 rowspan=2 class=dial>1p left/right dial counter
	</tr>
	<tr>
		<th>0x0B
	</tr>
	<tr>
		<th>0x0C
		<td colspan=8 rowspan=2 class=dial>2p up/down dial counter
	</tr>
	<tr>
		<th>0x0D
	</tr>
	<tr>
		<th>0x0E
		<td colspan=8 rowspan=2 class=dial>2p left/right dial counter
	</tr>
	<tr>
		<th>0x0F
	</tr>
	<tr>
		<th>0x10
		<td colspan=8>???
	</tr>
	<tr>
		<th>0x11
		<td colspan=8>???
	</tr>
	<tr>
		<th>0x12
		<td class=in>3p button1<pin-label>pin 41</pin-label>
		<td class=in>3p button2<pin-label>pin 42</pin-label>
		<td class=in>3p button3<pin-label>pin 43</pin-label>
		<td class=in>nc<pin-label>pin 44?</pin-label>
		<td class=in>4p button1<pin-label>pin 45</pin-label>
		<td class=in>4p button2<pin-label>pin 46</pin-label>
		<td class=in>4p button3<pin-label>pin 47</pin-label>
		<td class=in>nc<pin-label>pin 48?</pin-label>
	</tr>
	<tr>
		<th>0x13
		<td class=out>Z pin 3?<pin-label>pin 58?</pin-label>
		<td class=out>Z pin 4?<pin-label>pin 59?</pin-label>
		<td class=out>eeprom DI<pin-label>pin 62</pin-label>
		<td class=out>eeprom CLK<pin-label>pin 63</pin-label>
		<td class=out>eeprom CS<pin-label>pin 64</pin-label>
		<td class=out>nc?<pin-label>pin 65?</pin-label>
		<td class=out>nc?<pin-label>pin 66?</pin-label>
		<td class=out>nc?<pin-label>pin 67?</pin-label>
	</tr>
	<tr>
		<th>0x14
		<td class=out>coin 3 lockout<pin-label>pin 69</pin-label>
		<td class=out>coin 4 lockout<pin-label>pin 70</pin-label>
		<td class=out>coin 3 counter<pin-label>pin 71</pin-label>
		<td class=out>coin 4 counter<pin-label>pin 72</pin-label>
		<td colspan=4>?
	</tr>
	<tr>
		<th>0x15
		<td colspan=8>?
	</tr>
	<tr>
		<th>0x16
		<td>1?
		<td>1?
		<td>1?
		<td>1?
		<td>0?
		<td>0?
		<td>0?
		<td>0?
	</tr>
	<tr>
		<th>0x17
		<td class=in>3p stick up<pin-label>pin 49</pin-label>
		<td class=in>3p stick down<pin-label>pin 50</pin-label>
		<td class=in>3p stick left<pin-label>pin 51</pin-label>
		<td class=in>3p stick right<pin-label>pin 52</pin-label>
		<td class=in>4p stick up<pin-label>pin 53</pin-label>
		<td class=in>4p stick down<pin-label>pin 54</pin-label>
		<td class=in>4p stick left<pin-label>pin 55</pin-label>
		<td class=in>4p stick right<pin-label>pin 56</pin-label>
	</tr>
	<tr>
		<th>0x18
		<td colspan=8 rowspan=2 class=dial>3p up/down dial counter
	</tr>
	<tr>
		<th>0x19
	</tr>
	<tr>
		<th>0x1A
		<td colspan=8 rowspan=2 class=dial>3p left/right dial counter
	</tr>
	<tr>
		<th>0x1B
	</tr>
	<tr>
		<th>0x1C
		<td colspan=8 rowspan=2 class=dial>4p up/down dial counter
	</tr>
	<tr>
		<th>0x1D
	</tr>
	<tr>
		<th>0x1E
		<td colspan=8 rowspan=2 class=dial>4p left/right dial counter
	</tr>
	<tr>
		<th>0x1F
	</tr>
</table>

<h2>Rotary Encoder Inputs</h2>

<p>Each joystick axis (8 total, 2 per player) can also be used as input for a rotary encoder (by connecting it to the up/down or left/right joystick input pins).<br>The FIO has a 16-bit (little endian) counter for each axis, which increments/decrements by 1 on each step (i.e. a full cycle (00 01 11 10) would increment/decrement the counter by 4)
<p>(Note: both input modes are always enabled; the game chooses whether to read the joystick bits or the dial counter registers. The F3 has a jumper switch for "joystick/sensor" mode, but this just configures pull-up/down resistors on some input lines)
<p>afaik, F3 games have only used dials (connected to the 1p and 2p left/right axes), but i have tested all 8 and they are real.
	
<h2>Watchdog</h2>
<p>todo: which address do you have to write to? MAME just checks for any writes to the first 4 bytes, but this is probably wrong.

<h2>Pinout</h2>

<p>(I wonder if some of those extra power/ground pins can actually configure whether certain ports are inputs or outputs? but it would be very difficult to test this)

<table class=pinout>
	<tr><th>1<td colspan=2 class=vcc>VCC</tr>
	<tr><th>2<td colspan=2 class=gnd>GND</tr>
	<tr><th>3<td colspan=2 class=vcc>VCC</tr>
	<tr><th>4<td colspan=2>??? VCC (through JP1)</tr>
	<tr><th>5<td colspan=2 class=gnd>GND</tr>
	<tr><th>6<td rowspan=4>port 0x04<br>(output)<td>bit 0</tr>
	<tr><th>7<td>bit 1</tr>
	<tr><th>8<td>bit 2</tr>
	<tr><th>9<td>bit 3</tr>
	<tr><th>10<td colspan=2 class=gnd>GND</tr>
	<tr><th>11<td rowspan=4>port 0x02<td>bit 0</tr>
	<tr><th>12<td>bit 1</tr>
	<tr><th>13<td>bit 2</tr>
	<tr><th>14<td>bit 3</tr>
	<tr><th>15<td colspan=2 class=gnd>GND</tr>
	<tr><th>16<td rowspan=4>port 0x02<td>bit 4</tr>
	<tr><th>17<td>bit 5</tr>
	<tr><th>18<td>bit 6</tr>
	<tr><th>19<td>bit 7</tr>
	<tr><th>20<td rowspan=8>port 0x07<br>(input + dials)<td>bit 0</tr>
	<tr><th>21<td>bit 1</tr>
	<tr><th>22<td>bit 2</tr>
	<tr><th>23<td>bit 3</tr>
	<tr><th>24<td>bit 4</tr>
	<tr><th>25<td>bit 5</tr>
	<tr><th>26<td>bit 6</tr>
	<tr><th>27<td>bit 7</tr>
	<tr><th>28<td colspan=2 class=gnd>GND</tr>
	<tr><th>29<td>port 0x03<td>bit 0</tr>
	<tr><th>30<td colspan=2 class=vcc>VCC</tr>
	<tr class=pinout-divider><th>&nbsp;</tr>
	<tr><th>31<td colspan=2 class=gnd>GND</tr>
	<tr><th>32<td rowspan=3>port 0x03<td>bit 1</tr>
	<tr><th>33<td>bit 2</tr>
	<tr><th>34<td>bit 3?</tr>
	<tr><th>35<td colspan=2 class=gnd>GND</tr>
	<tr><th>36<td rowspan=4>port 0x03<td>bit 4</tr>
	<tr><th>37<td>bit 5</tr>
	<tr><th>38<td>bit 6</tr>
	<tr><th>39<td>bit 7</tr>
	<tr><th>40<td colspan=2 class=gnd>GND</tr>
	<tr><th>41<td rowspan=8>port 0x12<td>bit 0</tr>
	<tr><th>42<td>bit 1</tr>
	<tr><th>43<td>bit 2</tr>
	<tr><th>44<td>bit 3?</tr>
	<tr><th>45<td>bit 4</tr>
	<tr><th>46<td>bit 5</tr>
	<tr><th>47<td>bit 6</tr>
	<tr><th>48<td>bit 7?</tr>
	<tr><th>49<td rowspan=8>port 0x17<br>(input + dials)<td>bit 0</tr>
	<tr><th>50<td>bit 1</tr>
	<tr><th>51<td>bit 2</tr>
	<tr><th>52<td>bit 3</tr>
	<tr><th>53<td>bit 4</tr>
	<tr><th>54<td>bit 5</tr>
	<tr><th>55<td>bit 6</tr>
	<tr><th>56<td>bit 7</tr>
	<tr><th>57<td colspan=2 class=gnd>GND</tr>
	<tr><th>58<td rowspan=2>port 0x13<br>(output)<td>bit 0?</tr>
	<tr><th>59<td>bit 1?</tr>
	<tr><th>60<td colspan=2 class=gnd>GND</tr>
	<tr class=pinout-divider><th>&nbsp;</tr>
	<tr><th>61<td colspan=2 class=vcc>VCC</tr>
	<tr><th>62<td rowspan=6>port 0x13<br>(output)<td>bit 2</tr>
	<tr><th>63<td>bit 3</tr>
	<tr><th>64<td>bit 4</tr>
	<tr><th>65<td>bit 5?</tr>
	<tr><th>66<td>bit 6?</tr>
	<tr><th>67<td>bit 7?</tr>
	<tr><th>68<td colspan=2 class=gnd>GND</tr>
	<tr><th>69<td rowspan=4>port 0x14<br>(output)<td>bit 0</tr>
	<tr><th>70<td>bit 1</tr>
	<tr><th>71<td>bit 2</tr>
	<tr><th>72<td>bit 3</tr>
	<tr><th>73<td colspan=2 class=gnd>GND</tr>
	<tr><th>74<td>port 0x01<td>bit 7</tr>
	<tr><th>75<td colspan=2 class=gnd>GND</tr>
	<tr><th>76<td rowspan=7>port 0x01<td>bit 6</tr>
	<tr><th>77<td>bit 5</tr>
	<tr><th>78<td>bit 4</tr>
	<tr><th>79<td>bit 3?</tr>
	<tr><th>80<td>bit 2?</tr>
	<tr><th>81<td>bit 1</tr>
	<tr><th>82<td>bit 0</tr>
	<tr><th>83<td rowspan=7>port 0x00<td>bit 7?</tr>
	<tr><th>84<td>bit 6?</tr>
	<tr><th>85<td>bit 5?</tr>
	<tr><th>86<td>bit 4?</tr>
	<tr><th>87<td>bit 3</tr>
	<tr><th>88<td>bit 2?</tr>
	<tr><th>89<td>bit 1?</tr>
	<tr><th>90<td colspan=2 class=vcc>VCC</tr>
	<tr class=pinout-divider><th>&nbsp;</tr>
	<tr><th>91<td colspan=2 class=gnd>GND</tr>
	<tr><th>92<td>port 0x00<td>bit 0?</tr>
	<tr><th>93<td colspan=2 class=gnd>GND</tr>
	<tr><th>94<td colspan=2>cpu reset</tr>
	<tr><th>95<td colspan=2>cpu halt</tr>
	<tr><th>96<td colspan=2 class=gnd>GND</tr>
	<tr><th>97<td rowspan=4>cpu data<td>bit 0</tr>
	<tr><th>98<td>bit 1</tr>
	<tr><th>99<td>bit 2</tr>
	<tr><th>100<td>bit 3</tr>
	<tr><th>101<td colspan=2 class=gnd>GND</tr>
	<tr><th>102<td rowspan=4>cpu data<td>bit 4</tr>
	<tr><th>103<td>bit 5</tr>
	<tr><th>104<td>bit 6</tr>
	<tr><th>105<td>bit 7</tr>
	<tr><th>106<td colspan=2 class=gnd>GND</tr>
	<tr><th>107<td colspan=2>clock input ? (1 MHz)</tr>
	<tr><th>108<td colspan=2 class=gnd>GND</tr>
	<tr><th>109<td rowspan=5>cpu address<td>bit 4</tr>
	<tr><th>110<td>bit 3</tr>
	<tr><th>111<td>bit 2</tr>
	<tr><th>112<td>bit 1</tr>
	<tr><th>113<td>bit 0</tr>
	<tr><th>114<td colspan=2 class=gnd>GND</tr>
	<tr><th>115<td colspan=2>reset input ? (mb3771.reset)</tr>
	<tr><th>116<td colspan=2>read/write ? (cpuram.rw, pal2.21) </tr>
	<tr><th>117<td colspan=2>output enable ? (cpuram.oe, pal2.20)</tr>
	<tr><th>118<td colspan=2>maybe chip select ? (FCM.106)</tr>
	<tr><th>119<td colspan=2 class=gnd>GND</tr>
	<tr><th>120<td colspan=2 class=gnd>GND</tr>
</table>
